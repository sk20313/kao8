<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#1a2a6c" />
  <title>å°é«˜çš„éº»è¡£ç›¸æ³•éŠæˆ²å±‹ - AI é¢ç›¸åˆ†æ</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ===== é€šç”¨æ ·å¼ ===== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #0f1b40, #1a2a6c, #4a235a);
      color: #fff;
      min-height: 100vh;
      padding: 20px;
      background-attachment: fixed;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: rgba(10, 15, 35, 0.85);
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
      overflow: hidden;
      border: 1px solid #5d8bf9;
      padding: 30px;
      position: relative;
    }
    
    h1 {
      font-size: 2.8rem;
      color: #ffcc00;
      text-align: center;
      text-shadow: 0 3px 6px rgba(0, 0, 0, 0.5);
      margin-bottom: 10px;
      background: linear-gradient(to right, #ffcc00, #ff9900);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: 1px;
    }
    
    p.subtitle {
      text-align: center;
      font-size: 1.2rem;
      opacity: 0.9;
      margin: 10px 0 30px;
      color: #aaccff;
    }
    
    h2.section-title {
      color: #5d8bf9;
      margin-bottom: 25px;
      padding-bottom: 12px;
      border-bottom: 2px solid rgba(93, 139, 249, 0.5);
      font-size: 1.8rem;
      text-align: center;
      position: relative;
    }
    
    h2.section-title::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: linear-gradient(to right, #ffcc00, #ff9900);
      border-radius: 3px;
    }

    /* ===== ä¸Šå‚³å€ ===== */
    #uploadArea {
      border: 3px dashed #5d8bf9;
      border-radius: 15px;
      padding: 50px 30px;
      text-align: center;
      cursor: pointer;
      background: rgba(20, 40, 80, 0.3);
      transition: all 0.4s ease;
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
    }
    
    #uploadArea:hover {
      background: rgba(30, 60, 120, 0.4);
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(93, 139, 249, 0.3);
    }
    
    #uploadArea::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
      transform: rotate(30deg);
    }
    
    #fileInput {
      display: none;
    }
    
    .upload-icon {
      font-size: 5rem;
      margin-bottom: 20px;
      color: #ffcc00;
      text-shadow: 0 2px 8px rgba(255, 204, 0, 0.4);
      transition: transform 0.3s ease;
    }
    
    #uploadArea:hover .upload-icon {
      transform: scale(1.1);
    }
    
    #uploadArea p {
      font-size: 1.3rem;
      margin-bottom: 10px;
    }
    
    .note {
      font-size: 1rem;
      opacity: 0.8;
      color: #aaccff;
    }
    
    .forehead-warning {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      background: rgba(255, 100, 100, 0.2);
      border-radius: 10px;
      padding: 10px;
      margin-top: 15px;
      border: 1px solid rgba(255, 100, 100, 0.5);
    }
    
    .forehead-warning i {
      color: #ff6b6b;
      font-size: 1.3rem;
    }

    /* ===== Canvas èˆ‡æ¯”ä¾‹å¡ ===== */
    .face-canvas-container {
      text-align: center;
      margin: 30px 0;
      position: relative;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }
    
    #faceCanvas {
      max-width: 100%;
      border: 2px solid #5d8bf9;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.3);
      display: block;
      margin: 0 auto;
    }
    
    .ratio-box {
      margin-top: 30px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 15px;
    }
    
    .ratio-card {
      background: rgba(30, 60, 120, 0.3);
      border: 1px solid rgba(93, 139, 249, 0.5);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
    }
    
    .ratio-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(93, 139, 249, 0.3);
      border-color: #ffcc00;
    }
    
    .ratio-value {
      font-size: 2.3rem;
      font-weight: bold;
      color: #ffcc00;
      text-shadow: 0 2px 4px rgba(255, 204, 0, 0.3);
      margin: 10px 0;
    }
    
    .ratio-label {
      font-size: 1rem;
      opacity: 0.9;
      color: #aaccff;
    }

    /* ===== é€²åº¦æ¢çµæœå€ ===== */
    .result-box {
      background: rgba(20, 40, 80, 0.4);
      border-radius: 15px;
      padding: 25px;
      margin-top: 30px;
      border: 2px solid #5d8bf9;
      backdrop-filter: blur(5px);
    }
    
    .result-item {
      display: flex;
      justify-content: space-between;
      padding: 15px 0;
      border-bottom: 1px solid rgba(93, 139, 249, 0.3);
      font-size: 1.1rem;
    }
    
    .progress-container {
      height: 24px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      margin: 12px 0 25px;
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.4);
    }
    
    .progress-bar {
      height: 100%;
      background: linear-gradient(to right, #ffcc00, #ff9900);
      border-radius: 12px;
      width: 0%;
      transition: width 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      position: relative;
      overflow: hidden;
    }
    
    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, 
        rgba(255,255,255,0) 0%, 
        rgba(255,255,255,0.3) 50%, 
        rgba(255,255,255,0) 100%);
      animation: shine 2s infinite;
    }
    
    @keyframes shine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* ===== Buttons ===== */
    .btn-main {
      background: linear-gradient(to right, #ffcc00, #ff9900);
      color: #1a1a40;
      border: none;
      padding: 16px 35px;
      font-size: 1.2rem;
      border-radius: 50px;
      cursor: pointer;
      width: 100%;
      font-weight: bold;
      letter-spacing: 1px;
      box-shadow: 0 6px 18px rgba(255, 153, 0, 0.4);
      transition: all 0.3s ease;
      margin: 15px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .btn-main:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(255, 153, 0, 0.5);
    }
    
    .btn-main:disabled {
      background: #555;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }
    
    .btn-group {
      display: flex;
      gap: 15px;
      margin-top: 15px;
    }
    
    .btn-group .btn-main {
      width: auto;
      flex: 1;
    }

    /* PWA install */
    #installBtn {
      position: fixed;
      bottom: 25px;
      right: 25px;
      background: linear-gradient(to right, #ffcc00, #ff9900);
      color: #1a1a40;
      padding: 14px 24px;
      border-radius: 50px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
      display: none;
      z-index: 99;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      border: none;
    }
    
    #installBtn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(255, 153, 0, 0.5);
    }

    /* åŠ è¼‰æŒ‡ç¤ºå™¨ */
    .loader {
      display: none;
      width: 60px;
      height: 60px;
      border: 6px solid rgba(93, 139, 249, 0.3);
      border-radius: 50%;
      border-top-color: #5d8bf9;
      animation: spin 1.2s linear infinite;
      margin: 30px auto;
      position: relative;
    }
    
    .loader::after {
      content: '';
      position: absolute;
      top: -6px;
      left: -6px;
      right: -6px;
      bottom: -6px;
      border: 6px solid transparent;
      border-radius: 50%;
      border-top-color: #ffcc00;
      animation: spin 1.5s linear infinite reverse;
    }
    
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* é¢ç›¸åˆ†æèªªæ˜ */
    .analysis-explanation {
      margin-top: 30px;
      padding: 25px;
      background: rgba(30, 60, 120, 0.3);
      border-radius: 15px;
      border: 1px solid #5d8bf9;
      backdrop-filter: blur(5px);
    }
    
    .analysis-explanation h3 {
      color: #ffcc00;
      margin-bottom: 20px;
      font-size: 1.5rem;
      text-align: center;
      position: relative;
      padding-bottom: 10px;
    }
    
    .analysis-explanation h3::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: linear-gradient(to right, #ffcc00, #ff9900);
      border-radius: 3px;
    }
    
    .analysis-explanation p {
      margin-bottom: 15px;
      font-size: 1.05rem;
      padding-left: 20px;
      position: relative;
    }
    
    .analysis-explanation p::before {
      content: 'â€¢';
      color: #ffcc00;
      position: absolute;
      left: 0;
      font-size: 1.3rem;
    }
    
    .analysis-explanation strong {
      color: #ffcc00;
    }

    /* çµæœå‹•ç•« */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.8s ease forwards;
    }
    
    /* æ¨™è¨˜é»æ¨£å¼ */
    .landmark-point {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #ff3366;
      box-shadow: 0 0 8px rgba(255, 51, 102, 0.8);
      transform: translate(-50%, -50%);
      z-index: 10;
    }
    
    /* åƒè€ƒç·šæ¨£å¼ */
    .reference-line {
      position: absolute;
      background: rgba(93, 139, 249, 0.7);
      z-index: 5;
    }
    
    /* å¨›æ¨‚é¢ç›¸çµæœæ¨£å¼ */
    .entertainment-result {
      background: rgba(30, 15, 60, 0.7);
      border-radius: 15px;
      padding: 20px;
      margin-top: 20px;
      border: 2px solid #9c4dff;
      display: none;
    }
    
    .entertainment-header {
      color: #ffcc00;
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.6rem;
    }
    
    .entertainment-feature {
      margin: 15px 0;
      padding: 10px;
      background: rgba(100, 50, 150, 0.3);
      border-radius: 10px;
      border-left: 3px solid #9c4dff;
    }
    
    .entertainment-tags {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 20px 0;
    }
    
    .entertainment-tag {
      background: linear-gradient(to right, #9c4dff, #6a5af9);
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      font-weight: bold;
    }
    
    .entertainment-quote {
      font-style: italic;
      text-align: center;
      padding: 15px;
      background: rgba(255, 215, 0, 0.1);
      border-radius: 10px;
      margin: 20px 0;
      border-left: 3px solid #ffcc00;
    }
    
    .entertainment-disclaimer {
      background: rgba(200,0,0,0.1);
      border: 1px solid rgba(255,0,0,0.3);
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      font-size: 0.9rem;
      text-align: center;
    }
    
    .entertainment-btn {
      background: linear-gradient(to right, #9c4dff, #6a5af9);
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 1rem;
      border-radius: 50px;
      cursor: pointer;
      transition: 0.3s;
      display: block;
      margin: 20px auto;
      font-weight: bold;
      letter-spacing: 1px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .entertainment-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.5);
    }
    
    /* å„ªåŒ–æç¤º */
    .tips-container {
      background: rgba(30, 60, 120, 0.3);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid #5d8bf9;
      backdrop-filter: blur(5px);
    }
    
    .tips-header {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #ffcc00;
      margin-bottom: 15px;
      font-size: 1.3rem;
    }
    
    .tip-item {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      padding: 8px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
    }
    
    .tip-item i {
      color: #ffcc00;
      min-width: 24px;
      font-size: 1.2rem;
    }

    /* é»ä½èªªæ˜ */
    .point-info {
      background: rgba(30, 60, 120, 0.3);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid #5d8bf9;
      backdrop-filter: blur(5px);
    }
    
    .point-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .point-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
    }
    
    .point-color {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      margin: 0 auto 10px;
    }
    
    .point-forehead {
      background: #00ff00;
    }
    
    .point-eyebrow {
      background: #ff9900;
    }
    
    .point-nose {
      background: #ff3366;
    }
    
    .point-chin {
      background: #9c4dff;
    }

    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 768px) {
      h1 {
        font-size: 2.2rem;
      }
      
      .container {
        padding: 20px;
      }
      
      #uploadArea {
        padding: 30px 15px;
      }
      
      .btn-group {
        flex-direction: column;
      }
      
      .ratio-box {
        grid-template-columns: 1fr;
      }
      
      .result-box {
        padding: 20px;
      }
      
      .analysis-explanation {
        padding: 20px;
      }
      
      .tips-container, .point-info {
        padding: 15px;
      }
      
      .point-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    @media (max-width: 480px) {
      h1 {
        font-size: 1.8rem;
      }
      
      p.subtitle {
        font-size: 1rem;
      }
      
      .btn-main {
        padding: 14px 20px;
        font-size: 1.1rem;
      }
      
      .point-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><i class="fas fa-crown"></i> å°é«˜çš„éº»è¡£ç›¸æ³•éŠæˆ²å±‹</h1>
    <p class="subtitle">AI é¢ç›¸åˆ†æ - æ”¯æ´ PWAã€FaceMesh ä¸‰åº­äº”çœ¼è¨ˆç®—</p>

    <!-- ========== ä¸Šå‚³å€ ========= -->
    <div id="uploadArea">
      <div class="upload-icon"><i class="fas fa-camera"></i></div>
      <p>é»æ“Šæˆ–æ‹–æ”¾é¢éƒ¨ç…§ç‰‡åˆ°é€™è£¡</p>
      <p class="note">(æ­£é¢æ¸…æ™°ç…§ç‰‡æ•ˆæœæœ€ä½³ï¼Œè«‹ç¢ºä¿é¡é ­éœ²å‡º)</p>
      <div class="forehead-warning">
        <i class="fas fa-exclamation-triangle"></i>
        <span>é‡è¦ï¼šé¡é ­å¿…é ˆå®Œæ•´éœ²å‡ºæ‰èƒ½é€²è¡Œåˆ†æ</span>
      </div>
      <input type="file" accept="image/*" id="fileInput" />
    </div>

    <div class="loader" id="loader"></div>

    <!-- é¡é ­æª¢æ¸¬æç¤º -->
    <div class="tips-container" id="foreheadTips">
      <div class="tips-header">
        <i class="fas fa-lightbulb"></i>
        <h3>é¡é ­æª¢æ¸¬æç¤º</h3>
      </div>
      <div class="tip-item">
        <i class="fas fa-check-circle"></i>
        <div>è«‹ç¢ºä¿é¡é ­å€åŸŸå®Œå…¨éœ²å‡ºï¼Œä¸è¦æœ‰åŠ‰æµ·é®æ“‹</div>
      </div>
      <div class="tip-item">
        <i class="fas fa-check-circle"></i>
        <div>ä¿æŒå…‰ç·šå……è¶³ï¼Œé¿å…é™°å½±é®è“‹é¡é ­</div>
      </div>
      <div class="tip-item">
        <i class="fas fa-check-circle"></i>
        <div>æ‹æ”æ™‚è«‹ä¿æŒé ­éƒ¨æ­£ç›´ï¼Œä¸è¦ä»°é ­æˆ–ä½é ­</div>
      </div>
      <div class="tip-item">
        <i class="fas fa-check-circle"></i>
        <div>é¿å…å¸½å­ã€é ­é£¾ç­‰é®æ“‹ç‰©</div>
      </div>
    </div>

    <!-- é»ä½èªªæ˜ -->
    <div class="point-info">
      <div class="tips-header">
        <i class="fas fa-map-marker-alt"></i>
        <h3>é¢éƒ¨é—œéµé»èªªæ˜</h3>
      </div>
      <p>ç‚ºäº†ç²¾ç¢ºè¨ˆç®—ä¸‰åº­æ¯”ä¾‹ï¼Œæˆ‘å€‘ä½¿ç”¨ä»¥ä¸‹é¢éƒ¨é—œéµé»ï¼š</p>
      <div class="point-grid">
        <div class="point-card">
          <div class="point-color point-forehead"></div>
          <div>é¡é ­é» (ç´¢å¼•9)</div>
          <div>é«®éš›ç·šä½ç½®</div>
        </div>
        <div class="point-card">
          <div class="point-color point-eyebrow"></div>
          <div>çœ‰æ¯›é» (ç´¢å¼•168)</div>
          <div>çœ‰æ¯›ä¸­å¿ƒä½ç½®</div>
        </div>
        <div class="point-card">
          <div class="point-color point-nose"></div>
          <div>é¼»å°–é» (ç´¢å¼•2)</div>
          <div>é¼»å­æœ€ä¸‹ç«¯</div>
        </div>
        <div class="point-card">
          <div class="point-color point-chin"></div>
          <div>ä¸‹å·´é» (ç´¢å¼•152)</div>
          <div>ä¸‹å·´æœ€ä¸‹ç«¯</div>
        </div>
      </div>
    </div>

    <!-- Canvas + Ratio -->
    <div class="face-canvas-container">
      <canvas id="faceCanvas" width="500" height="500"></canvas>
    </div>

    <div class="ratio-box">
      <div class="ratio-card fade-in">
        <div class="ratio-label">ä¸Šåº­æ¯”ä¾‹</div>
        <div id="ratioTop" class="ratio-value">--</div>
        <div class="ratio-label">(é¡é ­)</div>
      </div>
      <div class="ratio-card fade-in">
        <div class="ratio-label">ä¸­åº­æ¯”ä¾‹</div>
        <div id="ratioMid" class="ratio-value">--</div>
        <div class="ratio-label">(çœ‰æ¯›åˆ°é¼»å°–)</div>
      </div>
      <div class="ratio-card fade-in">
        <div class="ratio-label">ä¸‹åº­æ¯”ä¾‹</div>
        <div id="ratioLow" class="ratio-value">--</div>
        <div class="ratio-label">(é¼»å°–åˆ°ä¸‹å·´)</div>
      </div>
      <div class="ratio-card fade-in">
        <div class="ratio-label">äº”çœ¼æ¯”ä¾‹</div>
        <div id="ratioFiveEye" class="ratio-value">--</div>
        <div class="ratio-label">(è‡‰å¯¬/çœ¼å¯¬)</div>
      </div>
    </div>

    <!-- ä¸»æ“ä½œæŒ‰éˆ• -->
    <button id="analyzeBtn" class="btn-main" disabled>
      <i class="fas fa-search"></i> åˆ†æé¢ç›¸
    </button>
    
    <div class="btn-group">
      <button id="cameraBtn" class="btn-main">
        <i class="fas fa-camera"></i> ä½¿ç”¨ç›¸æ©Ÿæ‹æ”
      </button>
      <button id="resetBtn" class="btn-main">
        <i class="fas fa-redo"></i> é‡ç½®åˆ†æ
      </button>
    </div>

    <!-- æ–°å¢å¨›æ¨‚é¢ç›¸æŒ‰éˆ• -->
    <button id="entertainmentBtn" class="entertainment-btn">
      <i class="fas fa-theater-masks"></i> ç”Ÿæˆå¨›æ¨‚é¢ç›¸åŠ‡æœ¬
    </button>

    <!-- ========== åˆ†æ•¸çµæœç°¡ç‰ˆ ========= -->
    <div class="result-box" id="scoreBox" style="display:none;">
      <h2 class="section-title">é¢ç›¸åˆ†æçµæœ</h2>
      
      <div class="result-item fade-in">
        <span><i class="fas fa-star"></i> æ•´é«”æ ¼å±€è©•åƒ¹</span>
        <span id="overallScore">--</span>
      </div>
      <div class="progress-container">
        <div class="progress-bar" id="overallBar"></div>
      </div>
      
      <div class="result-item fade-in">
        <span><i class="fas fa-briefcase"></i> äº‹æ¥­é‹å‹¢</span>
        <span id="careerScore">--</span>
      </div>
      <div class="progress-container">
        <div class="progress-bar" id="careerBar"></div>
      </div>
      
      <div class="result-item fade-in">
        <span><i class="fas fa-money-bill-wave"></i> è²¡å¯Œé‹å‹¢</span>
        <span id="wealthScore">--</span>
      </div>
      <div class="progress-container">
        <div class="progress-bar" id="wealthBar"></div>
      </div>
      
      <div class="result-item fade-in">
        <span><i class="fas fa-heartbeat"></i> å¥åº·é‹å‹¢</span>
        <span id="healthScore">--</span>
      </div>
      <div class="progress-container">
        <div class="progress-bar" id="healthBar"></div>
      </div>
    </div>
    
    <!-- é¢ç›¸åˆ†æèªªæ˜ -->
    <div class="analysis-explanation">
      <h3><i class="fas fa-lightbulb"></i> é¢ç›¸å­¸çŸ¥è­˜èªªæ˜</h3>
      <p><strong>ä¸‰åº­æ¯”ä¾‹ï¼š</strong> ä¸Šåº­(é¡é ­)ã€ä¸­åº­(çœ‰æ¯›åˆ°é¼»å°–)ã€ä¸‹åº­(é¼»å°–åˆ°ä¸‹å·´)çš„ç†æƒ³æ¯”ä¾‹æ˜¯1:1:1</p>
      <p><strong>äº”çœ¼æ¯”ä¾‹ï¼š</strong> è‡‰éƒ¨å¯¬åº¦æ‡‰ç­‰æ–¼äº”éš»çœ¼ç›çš„å¯¬åº¦ï¼Œç†æƒ³å€¼ç‚º5.0å·¦å³</p>
      <p><strong>é¡é ­ï¼š</strong> é«˜è€Œå¯¬é—Šçš„é¡é ­ä»£è¡¨æ™ºæ…§å’Œäº‹æ¥­é‹</p>
      <p><strong>é¼»å­ï¼š</strong> æŒºç›´çš„é¼»å­ä»£è¡¨è²¡é‹å’Œé ˜å°åŠ›</p>
      <p><strong>ä¸‹å·´ï¼š</strong> åœ“æ½¤çš„ä¸‹å·´ä»£è¡¨è²¡å¯Œå’Œæ™šå¹´é‹å‹¢</p>
      <p><strong>çœ¼ç›ï¼š</strong> æ˜äº®æœ‰ç¥çš„çœ¼ç›ä»£è¡¨å¥åº·å’Œæ´»åŠ›</p>
    </div>
    
    <!-- å¨›æ¨‚é¢ç›¸çµæœå€åŸŸ -->
    <div class="entertainment-result" id="entertainmentResult">
      <div class="entertainment-header">ğŸ­ AIé¢ç›¸åŠ‡æœ¬ç”Ÿæˆ</div>
      
      <div class="entertainment-feature">
        <h3>ğŸŒœ æ‚¨çš„é¢ç›¸ç‰¹å¾µ</h3>
        <p id="entertainmentFeatures">ç‰¹å¾µç”Ÿæˆä¸­...</p>
      </div>
      
      <div class="entertainment-quote" id="entertainmentQuote">
        "å¤ç±å¼•æ–‡ç”Ÿæˆä¸­..."
      </div>
      
      <div class="entertainment-tags" id="entertainmentTags">
        <!-- æ¨™ç±¤å°‡ç”±JSå‹•æ…‹ç”Ÿæˆ -->
      </div>
      
      <div class="entertainment-disclaimer">
        âš ï¸ å…è²¬è²æ˜ï¼šæœ¬åˆ†æç‚ºAIå¨›æ¨‚ç”Ÿæˆï¼Œç„¡ç§‘å­¸ä¾æ“šã€‚ç›¸ç”±å¿ƒç”Ÿï¼Œç¦è‡ªæˆ‘æ±‚ã€‚
      </div>
      
      <button class="entertainment-btn" onclick="generateEntertainmentReading()">
        <i class="fas fa-sync"></i> é‡æ–°ç”ŸæˆåŠ‡æœ¬
      </button>
      <button class="entertainment-btn" onclick="shareResult()">
        <i class="fas fa-share-alt"></i> åˆ†äº«æˆ‘çš„é¢ç›¸åŠ‡æœ¬
      </button>
    </div>
  </div>

  <!-- PWA Install Btn -->
  <div id="installBtn"><i class="fas fa-mobile-alt"></i> å®‰è£ç‚ºæ‡‰ç”¨</div>

  <script>
    // ======== PWA Install ========
    let deferredPrompt = null;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', e => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'block';
    });
    
    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === 'accepted') {
        console.log('User accepted the install prompt');
      }
      deferredPrompt = null;
      installBtn.style.display = 'none';
    });

    // ======== DOM ========
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const cameraBtn = document.getElementById('cameraBtn');
    const resetBtn = document.getElementById('resetBtn');
    const loader = document.getElementById('loader');
    const canvas = document.getElementById('faceCanvas');
    const ctx = canvas.getContext('2d');
    const ratioTopEl = document.getElementById('ratioTop');
    const ratioMidEl = document.getElementById('ratioMid');
    const ratioLowEl = document.getElementById('ratioLow');
    const ratioFiveEyeEl = document.getElementById('ratioFiveEye');
    const entertainmentBtn = document.getElementById('entertainmentBtn');
    const entertainmentResult = document.getElementById('entertainmentResult');
    const entertainmentFeatures = document.getElementById('entertainmentFeatures');
    const entertainmentQuote = document.getElementById('entertainmentQuote');
    const entertainmentTags = document.getElementById('entertainmentTags');

    // Score elements
    const scoreBox = document.getElementById('scoreBox');
    const overallScore = document.getElementById('overallScore');
    const careerScore = document.getElementById('careerScore');
    const wealthScore = document.getElementById('wealthScore');
    const healthScore = document.getElementById('healthScore');
    const overallBar = document.getElementById('overallBar');
    const careerBar = document.getElementById('careerBar');
    const wealthBar = document.getElementById('wealthBar');
    const healthBar = document.getElementById('healthBar');

    // ======== ç‹€æ…‹ ========
    let loadedImg = null;
    let landmarksCache = null;
    let stream = null;
    let faceMesh = null;
    let isCameraMode = false;

    // ======== åˆå§‹åŒ– FaceMesh ========
    async function initFaceMesh() {
      // ä½¿ç”¨æ­£ç¢ºçš„CDNè·¯å¾‘
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js';
      script.crossOrigin = 'anonymous';
      document.head.appendChild(script);
      
      await new Promise((resolve) => {
        script.onload = resolve;
      });
      
      // åˆå§‹åŒ–FaceMesh
      faceMesh = new FaceMesh({
        locateFile: (file) => {
          return `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`;
        }
      });
      
      faceMesh.setOptions({
        maxNumFaces: 1,
        refineLandmarks: true,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5
      });
      
      faceMesh.onResults(handleFaceMeshResults);
      
      console.log('FaceMesh initialized successfully');
    }

    // åˆå§‹åŒ– FaceMesh
    initFaceMesh().catch(err => {
      console.error('åˆå§‹åŒ– FaceMesh å¤±æ•—:', err);
      alert('ç„¡æ³•åˆå§‹åŒ–é¢éƒ¨è­˜åˆ¥åŠŸèƒ½ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š');
    });

    // ======== äº‹ä»¶ ========
    uploadArea.addEventListener('click', () => fileInput.click());
    uploadArea.addEventListener('dragover', e => {
      e.preventDefault();
      uploadArea.style.background = 'rgba(40, 80, 160, 0.4)';
    });
    uploadArea.addEventListener('dragleave', () => {
      uploadArea.style.background = 'rgba(20, 40, 80, 0.3)';
    });
    uploadArea.addEventListener('drop', e => {
      e.preventDefault();
      uploadArea.style.background = 'rgba(20, 40, 80, 0.3)';
      if (e.dataTransfer.files.length) {
        fileInput.files = e.dataTransfer.files;
        handleFile();
      }
    });
    fileInput.addEventListener('change', handleFile);
    analyzeBtn.addEventListener('click', analyzeFace);
    cameraBtn.addEventListener('click', openCamera);
    resetBtn.addEventListener('click', resetAnalysis);
    entertainmentBtn.addEventListener('click', showEntertainmentResult);

    // ======== æ–‡ä»¶è™•ç† ========
    function handleFile() {
      const file = fileInput.files[0];
      if (!file || !file.type.match('image.*')) {
        alert('è«‹é¸æ“‡æœ‰æ•ˆçš„åœ–ç‰‡');
        return;
      }
      
      // åœæ­¢ç›¸æ©Ÿæµ
      stopCameraStream();
      isCameraMode = false;
      
      const img = new Image();
      img.onload = () => {
        // èª¿æ•´ canvas å¤§å°ï¼Œä¿æŒæœ€å¤§é‚Š 500
        const max = 500;
        const ratio = Math.min(max / img.width, max / img.height, 1);
        canvas.width = img.width * ratio;
        canvas.height = img.height * ratio;
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        loadedImg = img;
        analyzeBtn.disabled = false;
        entertainmentBtn.disabled = false;
        
        // é‹è¡Œ FaceMesh
        runFaceMesh(img);
      };
      img.src = URL.createObjectURL(file);
    }

    // ======== ç›¸æ©ŸåŠŸèƒ½ ========
    async function openCamera() {
      try {
        // åœæ­¢ç¾æœ‰æµ
        stopCameraStream();
        
        // é‡ç½® canvas
        resetCanvas();
        isCameraMode = true;
        
        // è«‹æ±‚ç›¸æ©Ÿæ¬Šé™
        stream = await navigator.mediaDevices.getUserMedia({ 
          video: { 
            facingMode: 'user',
            width: { ideal: 1280 },
            height: { ideal: 720 }
          } 
        });
        
        const video = document.createElement('video');
        video.srcObject = stream;
        video.onloadedmetadata = () => {
          video.play();
          
          // è¨­ç½® canvas å°ºå¯¸
          const max = 500;
          const ratio = Math.min(max / video.videoWidth, max / video.videoHeight, 1);
          canvas.width = video.videoWidth * ratio;
          canvas.height = video.videoHeight * ratio;
          
          // ç¹ªè£½è¦–é »å¹€åˆ° canvas
          const drawFrame = () => {
            if (!stream) return;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // å¯¦æ™‚é‹è¡ŒFaceMesh
            if (faceMesh && isCameraMode) {
              faceMesh.send({image: canvas})
                .catch(err => console.error('FaceMesh error:', err));
            }
            
            requestAnimationFrame(drawFrame);
          };
          drawFrame();
          
          // å•Ÿç”¨åˆ†ææŒ‰éˆ•
          analyzeBtn.disabled = false;
          entertainmentBtn.disabled = false;
          loadedImg = video;
        };
      } catch (err) {
        console.error('ç›¸æ©ŸéŒ¯èª¤:', err);
        alert('ç„¡æ³•è¨ªå•ç›¸æ©Ÿï¼Œè«‹ç¢ºä¿å·²æˆäºˆæ¬Šé™');
      }
    }
    
    function stopCameraStream() {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
      }
    }

    // ======== FaceMesh ========
    async function runFaceMesh(img) {
      if (!faceMesh) {
        alert('é¢éƒ¨è­˜åˆ¥åŠŸèƒ½å°šæœªåˆå§‹åŒ–');
        return;
      }
      
      loader.style.display = 'block';
      analyzeBtn.disabled = true;
      entertainmentBtn.disabled = true;
      
      try {
        const off = document.createElement('canvas');
        off.width = img.width || img.videoWidth;
        off.height = img.height || img.videoHeight;
        const offCtx = off.getContext('2d');
        offCtx.drawImage(img, 0, 0, off.width, off.height);
        await faceMesh.send({image: off});
      } catch (err) {
        console.error('FaceMesh è™•ç†éŒ¯èª¤:', err);
        alert('é¢éƒ¨è­˜åˆ¥è™•ç†å¤±æ•—');
      } finally {
        loader.style.display = 'none';
        analyzeBtn.disabled = false;
        entertainmentBtn.disabled = false;
      }
    }

    function handleFaceMeshResults(res) {
      if (!res.multiFaceLandmarks || !res.multiFaceLandmarks.length) {
        if (!isCameraMode) {
          alert('æœªæª¢æ¸¬åˆ°é¢éƒ¨ï¼Œè«‹ä¸Šå‚³æ¸…æ™°çš„æ­£é¢ç…§ç‰‡');
        }
        return;
      }
      
      landmarksCache = res.multiFaceLandmarks[0];
      
      // æª¢æŸ¥é¡é ­é—œéµé»ï¼ˆç´¢å¼•9ï¼‰æ˜¯å¦å­˜åœ¨
      if (!landmarksCache[9]) {
        if (!isCameraMode) {
          alert('ç„¡æ³•æª¢æ¸¬åˆ°é¡é ­å€åŸŸï¼Œè«‹ç¢ºä¿é¡é ­å®Œæ•´éœ²å‡ºä¸”å…‰ç·šå……è¶³');
          resetRatiosDisplay();
        }
        return;
      }
      
      // é¡é ­é»å¯è¦‹æ€§æª¢æŸ¥ï¼ˆyå€¼éå°è¡¨ç¤ºé¡é ­å¯èƒ½è¢«æˆªæ–·ï¼‰
      const foreheadPoint = landmarksCache[9];
      if (foreheadPoint.y < 0.1) {
        if (!isCameraMode) {
          alert('é¡é ­å€åŸŸä¸å®Œæ•´ï¼Œè«‹ç¢ºä¿ç…§ç‰‡åŒ…å«å®Œæ•´é¡é ­');
          resetRatiosDisplay();
        }
        return;
      }
      
      // æ›´æ–°æ¯”ä¾‹é¡¯ç¤º
      calcRatios(landmarksCache);

      // å¦‚æœæ˜¯ç›¸æ©Ÿæ¨¡å¼ï¼Œç¹ªè£½ç¶²æ ¼
      if (isCameraMode) {
        drawMesh();
      }
    }

    // ======== è¨ˆç®—æ¯”ä¾‹ ========
    function calcRatios(lm) {
      const w = canvas.width, h = canvas.height;
      const getY = i => lm[i].y * h;
      const getX = i => lm[i].x * w;
      
      // ä¸‰åº­è¨ˆç®— - ä½¿ç”¨ç´¢å¼•9ä½œç‚ºé¡é ­é ‚éƒ¨é»
      const yTop = getY(9);          // é¡é ­é ‚éƒ¨ï¼ˆé«®éš›ç·šä½ç½®ï¼‰
      const yBrow = getY(168);       // çœ‰æ¯›ä½ç½®
      const yNose = getY(2);         // é¼»å°–
      const yChin = getY(152);       // ä¸‹å·´åº•éƒ¨
      
      const topH = Math.abs(yBrow - yTop);
      const midH = Math.abs(yNose - yBrow);
      const lowH = Math.abs(yChin - yNose);
      const sum = topH + midH + lowH;
      
      ratioTopEl.textContent = (topH/sum).toFixed(2);
      ratioMidEl.textContent = (midH/sum).toFixed(2);
      ratioLowEl.textContent = (lowH/sum).toFixed(2);
      
      // äº”çœ¼è¨ˆç®—
      const faceW = Math.abs(getX(454) - getX(234));  // è‡‰éƒ¨å¯¬åº¦
      const eyeW = Math.abs(getX(133) - getX(33));    // çœ¼ç›å¯¬åº¦
      
      if (eyeW > 0) {
        ratioFiveEyeEl.textContent = (faceW/eyeW).toFixed(2);
      } else {
        ratioFiveEyeEl.textContent = '--';
      }
    }
    
    function resetRatiosDisplay() {
      ratioTopEl.textContent = '--';
      ratioMidEl.textContent = '--';
      ratioLowEl.textContent = '--';
      ratioFiveEyeEl.textContent = '--';
    }

    // ======== åˆ†æé¢ç›¸ ========
    function analyzeFace() {
      if (!landmarksCache) {
        alert('è«‹å…ˆä¸Šå‚³æˆ–æ‹æ”é¢éƒ¨ç…§ç‰‡');
        return;
      }
      
      drawMeshAndScores();
    }
    
    // ======== ç¹ªåœ–èˆ‡åˆ†æ•¸ ========
    function drawMesh() {
      if (!loadedImg || !landmarksCache) return;
      
      // é‡æ–°ç¹ªè£½åœ–åƒ
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(loadedImg, 0, 0, canvas.width, canvas.height);
      
      // ç¹ªè£½é¢éƒ¨é—œéµé»
      ctx.fillStyle = '#ff3366';
      landmarksCache.forEach(pt => {
        ctx.beginPath();
        ctx.arc(pt.x * canvas.width, pt.y * canvas.height, 3, 0, 2 * Math.PI);
        ctx.fill();
      });
      
      // ç¹ªè£½ä¸‰åº­äº”çœ¼åƒè€ƒç·š
      drawReferenceLines();
      
      // ç‰¹åˆ¥æ¨™è¨˜é—œéµé»
      drawKeyPoints();
    }
    
    function drawKeyPoints() {
      const w = canvas.width, h = canvas.height;
      const lm = landmarksCache;
      
      // é¡é ­é»ï¼ˆç¶ è‰²ï¼‰
      const foreheadPoint = lm[9];
      ctx.fillStyle = '#00ff00';
      ctx.beginPath();
      ctx.arc(foreheadPoint.x * w, foreheadPoint.y * h, 8, 0, 2 * Math.PI);
      ctx.fill();
      ctx.fillStyle = '#000';
      ctx.font = 'bold 12px sans-serif';
      ctx.fillText('é¡é ­é»(9)', foreheadPoint.x * w + 10, foreheadPoint.y * h);
      
      // çœ‰æ¯›é»ï¼ˆæ©™è‰²ï¼‰
      const browPoint = lm[168];
      ctx.fillStyle = '#ff9900';
      ctx.beginPath();
      ctx.arc(browPoint.x * w, browPoint.y * h, 8, 0, 2 * Math.PI);
      ctx.fill();
      ctx.fillStyle = '#000';
      ctx.fillText('çœ‰æ¯›é»(168)', browPoint.x * w + 10, browPoint.y * h);
      
      // é¼»å°–é»ï¼ˆç´…è‰²ï¼‰
      const nosePoint = lm[2];
      ctx.fillStyle = '#ff3366';
      ctx.beginPath();
      ctx.arc(nosePoint.x * w, nosePoint.y * h, 8, 0, 2 * Math.PI);
      ctx.fill();
      ctx.fillStyle = '#000';
      ctx.fillText('é¼»å°–é»(2)', nosePoint.x * w + 10, nosePoint.y * h);
      
      // ä¸‹å·´é»ï¼ˆç´«è‰²ï¼‰
      const chinPoint = lm[152];
      ctx.fillStyle = '#9c4dff';
      ctx.beginPath();
      ctx.arc(chinPoint.x * w, chinPoint.y * h, 8, 0, 2 * Math.PI);
      ctx.fill();
      ctx.fillStyle = '#000';
      ctx.fillText('ä¸‹å·´é»(152)', chinPoint.x * w + 10, chinPoint.y * h);
    }
    
    function drawMeshAndScores() {
      drawMesh();
      
      // ç”¢ç”Ÿåˆ†æ•¸
      generateFaceScores();
      
      // é¡¯ç¤ºçµæœ
      scoreBox.style.display = 'block';
      entertainmentResult.style.display = 'none';
      
      // è§¸ç™¼å‹•ç•«
      document.querySelectorAll('.fade-in').forEach(el => {
        el.style.animation = 'fadeIn 0.8s ease forwards';
      });
    }
    
    function drawReferenceLines() {
      const w = canvas.width, h = canvas.height;
      const lm = landmarksCache;
      const getY = i => lm[i].y * h;
      const getX = i => lm[i].x * w;
      
      ctx.strokeStyle = '#5d8bf9';
      ctx.lineWidth = 2;
      ctx.beginPath();
      
      // ä¸‰åº­æ°´å¹³ç·š - ä½¿ç”¨ç´¢å¼•9ä½œç‚ºé¡é ­é ‚éƒ¨
      ctx.moveTo(0, getY(9));
      ctx.lineTo(w, getY(9));
      
      ctx.moveTo(0, getY(168));
      ctx.lineTo(w, getY(168));
      
      ctx.moveTo(0, getY(2));
      ctx.lineTo(w, getY(2));
      
      ctx.moveTo(0, getY(152));
      ctx.lineTo(w, getY(152));
      
      // äº”çœ¼å‚ç›´ç·š
      const eyePoints = [33, 133, 263, 362, 454];
      eyePoints.forEach(i => {
        ctx.moveTo(getX(i), 0);
        ctx.lineTo(getX(i), h);
      });
      
      ctx.stroke();
    }
    
    function generateFaceScores() {
      // åŸºæ–¼ä¸‰åº­äº”çœ¼æ¯”ä¾‹ç”Ÿæˆåˆ†æ•¸
      const topRatio = parseFloat(ratioTopEl.textContent) || 0.33;
      const midRatio = parseFloat(ratioMidEl.textContent) || 0.33;
      const lowRatio = parseFloat(ratioLowEl.textContent) || 0.33;
      const eyeRatio = parseFloat(ratioFiveEyeEl.textContent) || 5.0;
      
      // æ•´é«”åˆ†æ•¸è¨ˆç®—
      const overall = Math.min(98, Math.floor(
        70 + 
        (1 - Math.abs(topRatio - 0.33)) * 15 + 
        (1 - Math.abs(midRatio - 0.33)) * 15 + 
        (1 - Math.abs(lowRatio - 0.33)) * 15 +
        (1 - Math.abs(eyeRatio - 5.0)/2) * 15
      ));
      
      // å„é …åˆ†æ•¸ï¼ˆåŸºæ–¼ä¸åŒé¢ç›¸ç‰¹å¾µï¼‰
      const career = Math.min(97, Math.floor(
        overall * 0.75 + 
        topRatio * 15 +  // é¡é ­ä»£è¡¨äº‹æ¥­
        Math.random() * 8
      ));
      
      const wealth = Math.min(96, Math.floor(
        overall * 0.7 + 
        lowRatio * 20 +  // ä¸‹å·´ä»£è¡¨è²¡å¯Œ
        Math.random() * 10
      ));
      
      const health = Math.min(95, Math.floor(
        overall * 0.85 + 
        midRatio * 15 +  // ä¸­åº­ä»£è¡¨å¥åº·
        Math.random() * 8
      ));
      
      // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
      overallScore.textContent = `${overall}/100`;
      careerScore.textContent = `${career}/100`;
      wealthScore.textContent = `${wealth}/100`;
      healthScore.textContent = `${health}/100`;
      
      // å‹•ç•«é¡¯ç¤ºé€²åº¦æ¢
      setTimeout(() => {
        overallBar.style.width = `${overall}%`;
        careerBar.style.width = `${career}%`;
        wealthBar.style.width = `${wealth}%`;
        healthBar.style.width = `${health}%`;
      }, 100);
    }

    // ======== å¨›æ¨‚é¢ç›¸åŠŸèƒ½ ========
    function showEntertainmentResult() {
      if (!landmarksCache) {
        alert('è«‹å…ˆä¸Šå‚³æˆ–æ‹æ”é¢éƒ¨ç…§ç‰‡');
        return;
      }
      
      // éš±è—æ¨™æº–çµæœï¼Œé¡¯ç¤ºå¨›æ¨‚çµæœ
      scoreBox.style.display = 'none';
      entertainmentResult.style.display = 'block';
      
      // ç”Ÿæˆå¨›æ¨‚é¢ç›¸åŠ‡æœ¬
      generateEntertainmentReading();
    }
    
    function generateEntertainmentReading() {
      // é¢ç›¸ç‰¹å¾µæ± 
      const features = {
        forehead: ["å¤©åº­é£½æ»¿å¦‚è¦†ç‰ï¼Œæ™ºæ…§è¶…ç¾¤é¡¯è²´æ°£", "ä¸Šåº­é«˜å»£æœ‰è²´æ°£ï¼Œå°‘å¹´å¾—å¿—å±•å®åœ–", "é¡è§’å´¢å¶¸é¡¯æ™ºæ…§ï¼Œæ‰æ€æ•æ·å† ç¾¤å€«"],
        eyes: ["é³³ç›®å«å¨è—é­„åŠ›ï¼Œæ±ºæ–·æœæ•¢é¡¯è‹±æ˜", "é¾ç›ç‚¯ç‚¯é€æ©Ÿæ•ï¼Œæ´å¯Ÿå…ˆæ©Ÿè­˜äººå¿ƒ", "æ¡ƒèŠ±çœ¼å¸¶ä¸‰åˆ†ç¬‘ï¼Œäººç·£å»£çµç¦é‹ä¾†"],
        nose: ["é¼»å¦‚æ‡¸è†½è²¡åº«è±ï¼Œå¯Œè²´æ¦®è¯è‡ªå¤©ä¾†", "å±±æ ¹è²«é ‚æ°£å‹¢é›„ï¼Œæ¬ŠæŸ„åœ¨æ¡é¡¯å¨åš´", "é¼»ç¿¼é£½æ»¿èšè²¡å¸›ï¼Œç†è²¡æœ‰æ–¹ç©è¬é‡‘"],
        mouth: ["å”‡è‹¥å¡—æœ±å–„è¨€è¾­ï¼Œå£æ‰ä¾¿çµ¦æœçœ¾äºº", "å£å¦‚å››å­—æŒå¨æ¬Šï¼Œè™Ÿä»¤å››æ–¹é¡¯å°Šæ¦®", "ä»°æœˆå”‡å½¢è²´äººæ‰¶ï¼Œç¦ç¥¿é›™å…¨äº«å®‰åº·"],
        special: ["æ³•ä»¤æ·±é•·è™Ÿä»¤æ˜ï¼Œçµ±å¾¡æœ‰æ–¹æˆå¤§äº‹", "è€³å‚åšå¤§ç¦å£½å¢ï¼Œæ™šé‹äº¨é€šå­å­«è³¢", "çœ‰é–“å·å­—æ€æ…®æ·±ï¼Œè¬€å®šå¾Œå‹•æˆå‰æ¥­"]
      };
      
      // å¤ç±å¼•æ–‡æ± 
      const quotes = [
        "ã€Šéº»è¡£ç›¸æ³•ã€‹ï¼š'çœ¼å¦‚æ—¥æœˆè¦åˆ†æ˜ï¼Œé³³ç›®é¾ç›åˆ‡è¦æ¸…'",
        "ã€ŠæŸ³èŠç›¸æ³•ã€‹ï¼š'é¼»å¦‚æ‡¸è†½èº«é ˆè²´ï¼ŒåœŸæ›œç•¶ç”Ÿå¾—åœ°ä¾†'",
        "ã€Šç¥ç›¸å…¨ç·¨ã€‹ï¼š'å¤©åº­é£½æ»¿å®œæ—©è²´ï¼Œåœ°é–£æ–¹åœ“æ™šé‹äº¨'",
        "ã€Šç‰ç®¡ç…§ç¥å±€ã€‹ï¼š'çœ‰æ¸…ç›®ç§€ç²¾ç¥è¶³ï¼Œå¯Œè²´æ¦®è¯è‡ªå¤©ä¾†'",
        "ã€Šå¤ªæ¸…ç¥é‘’ã€‹ï¼š'å£å¦‚å››å­—ä¸»å®˜è²´ï¼Œå”‡è‹¥å¡—æœ±ç¦å£½å¢'"
      ];
      
      // äººç”Ÿæ¨™ç±¤æ± 
      const tags = ["é­„åŠ›éå‡¡", "è²´äººç›¸æ‰¶", "æ™šé‹äº¨é€š", "æ‰æ€æ•æ·", 
                  "æƒ…è·¯é †é‚", "è²¡æºå»£é€²", "å¥åº·é•·å£½", "æ¬ŠæŸ„åœ¨æ¡",
                  "æ™ºæ…§è¶…ç¾¤", "ç¦æ¾¤ç¶¿é•·", "äººè„ˆé‡‘ç¤¦", "äº‹æ¥­é¨°é”"];
      
      // éš¨æ©Ÿé¸æ“‡å‡½æ•¸
      const getRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];
      
      // éš¨æ©Ÿé¸æ“‡3å€‹ä¸é‡è¤‡çš„æ¨™ç±¤
      const getRandomTags = () => {
        let result = [];
        while (result.length < 3) {
          const tag = tags[Math.floor(Math.random() * tags.length)];
          if (!result.includes(tag)) result.push(tag);
        }
        return result;
      };
      
      // æ§‹å»ºç‰¹å¾µæ–‡æœ¬
      const foreheadFeature = getRandom(features.forehead);
      const eyesFeature = getRandom(features.eyes);
      const noseFeature = getRandom(features.nose);
      const mouthFeature = getRandom(features.mouth);
      const specialFeature = getRandom(features.special);
      
      // æ§‹å»ºç‰¹å¾µHTML
      entertainmentFeatures.innerHTML = `
          <p>é¡ç›¸ï¼š${foreheadFeature}</p>
          <p>çœ¼ç›¸ï¼š${eyesFeature}</p>
          <p>é¼»ç›¸ï¼š${noseFeature}</p>
          <p>å”‡ç›¸ï¼š${mouthFeature}</p>
          <p>ç‰¹å¾µï¼š${specialFeature}</p>
      `;
      
      // æ§‹å»ºå¤ç±å¼•æ–‡
      entertainmentQuote.textContent = getRandom(quotes);
      
      // æ§‹å»ºæ¨™ç±¤
      const selectedTags = getRandomTags();
      entertainmentTags.innerHTML = '';
      selectedTags.forEach(tag => {
          const tagElement = document.createElement('div');
          tagElement.className = 'entertainment-tag';
          tagElement.textContent = `ã€${tag}ã€‘`;
          entertainmentTags.appendChild(tagElement);
      });
    }
    
    function shareResult() {
      const features = entertainmentFeatures.textContent;
      const quote = entertainmentQuote.textContent;
      const tags = Array.from(entertainmentTags.children).map(el => el.textContent).join(' ');
      
      const text = `æˆ‘çš„AIé¢ç›¸åŠ‡æœ¬ï¼š
ğŸ­ AIé¢ç›¸åŠ‡æœ¬ç”Ÿæˆ
ğŸŒœ é¢ç›¸ç‰¹å¾µï¼š
${features}
ğŸ“œ å¤ç±ä½è­‰ï¼š
"${quote}"
âœ¨ äººç”ŸåŠ‡æœ¬ï¼š
${tags}

âš ï¸ å…è²¬è²æ˜ï¼šæœ¬åˆ†æç‚ºAIå¨›æ¨‚ç”Ÿæˆï¼Œç„¡ç§‘å­¸ä¾æ“šã€‚ç›¸ç”±å¿ƒç”Ÿï¼Œç¦è‡ªæˆ‘æ±‚ã€‚
`;
      
      try {
        navigator.clipboard.writeText(text);
        alert('é¢ç›¸åŠ‡æœ¬å·²è¤‡è£½ï¼å¿«å»è²¼ä¸Šåˆ†äº«çµ¦æœ‹å‹å§~');
      } catch (err) {
        alert('ç„¡æ³•è¤‡è£½æ–‡æœ¬ï¼Œè«‹æ‰‹å‹•è¤‡è£½å…§å®¹');
      }
    }

    // ======== é‡ç½®åŠŸèƒ½ ========
    function resetAnalysis() {
      // åœæ­¢ç›¸æ©Ÿæµ
      stopCameraStream();
      isCameraMode = false;
      
      // é‡ç½®ç‹€æ…‹
      loadedImg = null;
      landmarksCache = null;
      fileInput.value = '';
      
      // é‡ç½® UI
      resetCanvas();
      resetRatiosDisplay();
      scoreBox.style.display = 'none';
      entertainmentResult.style.display = 'none';
      analyzeBtn.disabled = true;
      entertainmentBtn.disabled = true;
      
      // é‡ç½®é€²åº¦æ¢
      overallBar.style.width = '0%';
      careerBar.style.width = '0%';
      wealthBar.style.width = '0%';
      healthBar.style.width = '0%';
    }
    
    function resetCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = 'rgba(0,0,0,0.3)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#fff';
      ctx.font = 'bold 20px sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('è«‹ä¸Šå‚³æˆ–æ‹æ”é¢éƒ¨ç…§ç‰‡', canvas.width/2, canvas.height/2);
      
      // ç¹ªè£½ç›¸æ©Ÿåœ–æ¨™
      ctx.font = '60px FontAwesome';
      ctx.fillText('\uf030', canvas.width/2, canvas.height/2 - 50);
    }

    // åˆå§‹é‡ç½® canvas
    resetCanvas();

    // ======== Service Worker ========
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .catch(err => console.log('Service Worker è¨»å†Šå¤±æ•—:', err));
    }
  </script>
</body>
</html>